{"version":3,"sources":["../src/ctrl.js"],"names":["MetricsPanelCtrl","_","kbn","TimeSeries","d3","panelDefaults","legend","show","links","datasource","maxDataPoints","interval","targets","cacheTimeout","nullPointMode","aliasColors","format","valueName","strokeWidth","fontSize","width","height","colorSet","colorSch","GroupedBarChartCtrl","$scope","$injector","$rootScope","hiddenSeries","data","defaults","panel","events","on","onInitEditMode","bind","onDataReceived","onDataError","addEditorTab","subItem","value","render","forEach","push","d","color","dataList","o","groupBy","rows","e","forOwn","i","t","sta","sum","tid","map","s","reduce","x","y","res","label","sort","a","b","decimalInfo","getDecimalsForValue","formatFunc","valueFormats","decimals","scaledDecimals","scope","elem","attrs","ctrl","groupedBarChart","opts","margin","showLegend","element","find","options","keys","filter","key","avgList","valores","name","length","scale","ordinal","range","category20","draw","select","html","svg","append","attr","top","createScales","addAxes","addTooltips","addBar","addLegend","y0","rangeRoundBands","y1","linear","xAxis","axis","tickSize","orient","yAxis","domain","rangeBand","max","left","call","style","bar","selectAll","enter","barC","text","tips","elements","elementData","__data__","display","slice","onRender","sample","Chart","bottom","right","templateUrl"],"mappings":"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","file":"ctrl.js","sourcesContent":["import {MetricsPanelCtrl} from 'app/plugins/sdk';\r\nimport _ from 'lodash';\r\nimport kbn from 'app/core/utils/kbn';\r\nimport TimeSeries from 'app/core/time_series';\r\nimport * as d3 from './external/d3.v3.min';\r\nimport './css/groupedBarChart.css!';\r\n// import groupedBarChart from './external/groupedBarChart';\r\n\r\nconst panelDefaults = {\r\n    legend: {\r\n        show: true\r\n    },\r\n    links: [],\r\n    datasource: null,\r\n    maxDataPoints: 3,\r\n    interval: null,\r\n    targets: [{}],\r\n    cacheTimeout: null,\r\n    nullPointMode: 'connected',\r\n    aliasColors: {},\r\n    format: 'short',\r\n    valueName: 'current',\r\n    strokeWidth: 1,\r\n    fontSize: '80%',\r\n    width: 800,\r\n    height: 400,\r\n    colorSet: [],\r\n    colorSch: []\r\n};\r\n\r\nexport class GroupedBarChartCtrl extends MetricsPanelCtrl {\r\n\r\n    constructor($scope, $injector, $rootScope) {\r\n        super($scope, $injector);\r\n        this.$rootScope = $rootScope;\r\n        this.hiddenSeries = {};\r\n        this.data = null;\r\n\r\n        _.defaults(this.panel, panelDefaults);\r\n\r\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n        this.events.on('data-received', this.onDataReceived.bind(this));\r\n        this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\r\n        this.events.on('data-error', this.onDataError.bind(this));\r\n    }\r\n\r\n    onInitEditMode() {\r\n        this.addEditorTab('Options', 'public/plugins/grafana-groupedbarchart-panel/partials/editor.html', 2);\r\n        this.addEditorTab('Colors', 'public/plugins/grafana-groupedbarchart-panel/partials/colors.html', 3);\r\n    }\r\n\r\n    setUnitFormat(subItem) {\r\n        this.panel.format = subItem.value;\r\n        this.render();\r\n    }\r\n\r\n    onDataError() {\r\n        this.render();\r\n    }\r\n\r\n    updateColorSet() {\r\n        this.panel.colorSch = [];\r\n        this.panel.colorSet.forEach(d=>this.panel.colorSch.push(d.color));\r\n        this.render();\r\n    }\r\n\r\n    onDataReceived(dataList) {\r\n\r\n        let o = _.groupBy(dataList[0].rows, e=>e[0]);\r\n        _.forOwn(o, (e, i)=>{\r\n            let t = _.groupBy(e, sta=>sta[1]);\r\n            o[i] = _.forOwn(t, (sum, tid)=>{t[tid] = sum.map(s=>s[2]).reduce((x,y)=>x+y)})\r\n        });\r\n\r\n        let res = [];\r\n        _.forOwn(o, (e, i)=> {\r\n            e.label = i;\r\n            res.push(e);\r\n        });\r\n        this.data = res.sort((a, b)=>{return (a.label>b.label)?-1:((b.label>a.label)?1:0)});\r\n        this.render();\r\n    }\r\n\r\n    formatValue(value) {\r\n        let decimalInfo = this.getDecimalsForValue(value);\r\n        let formatFunc = kbn.valueFormats[this.panel.format];\r\n        if (formatFunc) {\r\n            return formatFunc(value, decimalInfo.decimals, decimalInfo.scaledDecimals);\r\n        }\r\n        return value;\r\n    }\r\n\r\n    link(scope, elem, attrs, ctrl) {\r\n        class groupedBarChart {\r\n            constructor(opts) {\r\n                this.data = opts.data;\r\n                this.margin = opts.margin;\r\n                this.width = opts.width;\r\n                this.height = opts.height;\r\n                this.showLegend = opts.legend;\r\n                this.element = elem.find(opts.element)[0];\r\n                this.options = d3.keys(this.data[0]).filter(function(key) { return key !== 'label'; });\r\n                this.avgList = {};\r\n                this.options.forEach(d=>{this.avgList[d] = 0});\r\n                this.options = this.options.filter(d=>d!=='valores');\r\n                this.data.forEach(d=> {\r\n                    d.valores = this.options.map(name=> {\r\n                        this.avgList[name] = this.avgList[name] + d[name];\r\n                        return {name: name, value: +d[name]};\r\n                    });\r\n                });\r\n                this.options.forEach(d=>{\r\n                    this.avgList[d] /= this.data.length;\r\n                });\r\n                if(opts.color.length == 0) {\r\n                    this.color = d3.scale.ordinal()\r\n                        .range(d3.scale.category20().range());\r\n                } else {\r\n                    this.color = d3.scale.ordinal()\r\n                        .range(opts.color);\r\n                }\r\n\r\n                this.draw();\r\n            }\r\n\r\n            draw() {\r\n                d3.select(this.element).html(\"\");\r\n                this.svg = d3.select(this.element).append('svg');\r\n                this.svg.attr('width', this.width)\r\n                    .attr('height', this.height)\r\n                    .attr('transform', `translate(0, ${this.margin.top})`);\r\n\r\n                this.createScales();\r\n                this.addAxes();\r\n                this.addTooltips();\r\n                this.addBar();\r\n                if(this.showLegend) this.addLegend();\r\n            }\r\n\r\n            createScales() {\r\n                this.y0 = d3.scale.ordinal()\r\n                    .rangeRoundBands([this.height, 0], .2, 0.5);\r\n\r\n                this.y1 = d3.scale.ordinal();\r\n\r\n                this.x = d3.scale.linear()\r\n                    .range([0, this.width]);\r\n\r\n            }\r\n\r\n            addAxes() {\r\n                this.xAxis = d3.svg.axis()\r\n                    .scale(this.x)\r\n                    .tickSize(-this.height)\r\n                    .orient('bottom');\r\n\r\n                this.yAxis = d3.svg.axis()\r\n                    .scale(this.y0)\r\n                    .orient('left');\r\n\r\n                this.y0.domain(this.data.map(d=> { return d.label; }));\r\n                this.y1.domain(this.options).rangeRoundBands([0, this.y0.rangeBand()]);\r\n                this.x.domain([0, d3.max(this.data, function(d) { return d3.max(d.valores, d=> { return d.value; }); })]);\r\n\r\n                this.svg.append('g')\r\n                    .attr('class', 'x axis')\r\n                    .attr('transform', `translate(${this.margin.left}, ${this.height})`)\r\n                    .call(this.xAxis);\r\n\r\n                this.svg.append('g')\r\n                    .attr('class', 'y axis')\r\n                    .attr('transform', `translate(${this.margin.left}, 0)`)\r\n                    .call(this.yAxis);\r\n            }\r\n\r\n            addBar() {\r\n                this.options.forEach(d=> {\r\n                    this.svg.append('line')\r\n                        .attr('x1', this.x(this.avgList[d]))\r\n                        .attr('y1', this.height)\r\n                        .attr('x2', this.x(this.avgList[d]))\r\n                        .attr('y2', 0)\r\n                        .attr('class', `${d} avgLine`)\r\n                        .attr('transform', `translate(${this.margin.left}, 0)`)\r\n                        .style('display', 'none')\r\n                        .style('stroke-width', 2)\r\n                        .style('stroke', this.color(d))\r\n                        .style('stroke-opacity', 0.7);\r\n                });\r\n\r\n                this.bar = this.svg.selectAll('.bar')\r\n                    .data(this.data)\r\n                    .enter().append('g')\r\n                    .attr('class', 'rect')\r\n                    .attr('transform', d=> {\r\n                        return `translate(${this.margin.left}, ${this.y0(d.label)})`;\r\n                    });\r\n\r\n                this.barC = this.bar.selectAll('rect')\r\n                    .data(d=> { return d.valores; })\r\n                    .enter();\r\n\r\n                this.barC.append('rect')\r\n                    .attr('height', this.y1.rangeBand())\r\n                    .attr('y', d=> { return this.y1(d.name);})\r\n                    .attr('x', d=> { return 0;})\r\n                    .attr('value', d=> { return d.name;})\r\n                    .attr('width', d=> { return this.x(d.value);})\r\n                    .style('fill', d=> { return this.color(d.name);});\r\n\r\n                this.barC.append('text')\r\n                    .attr('x', d=> { return this.x(d.value) +5;  })\r\n                    .attr('y', d=> { return this.y1(d.name) +(this.y1.rangeBand()/2); })\r\n                    .attr('dy', '.35em')\r\n                    .text(d=> { return d.value; });\r\n\r\n                this.bar.on('mouseover', d=> {\r\n                    this.tips.style('left', `${10}px`);\r\n                    this.tips.style('top', `${15}px`);\r\n                    this.tips.style('display', \"inline-block\");\r\n                    let elements = d3.selectAll(':hover')[0];\r\n                    let elementData = elements[elements.length-1].__data__;\r\n                    this.tips.html(`${d.label} , ${elementData.name} ,  ${elementData.value}`);\r\n                    d3.selectAll(`.${elementData.name}`)[0][0].style.display = '';\r\n                });\r\n\r\n                this.bar.on('mouseout', d=> {\r\n                    this.tips.style('display', \"none\");\r\n                    d3.selectAll('.avgLine')[0].forEach(d=> {\r\n                       d.style.display = 'none';\r\n                    });\r\n                });\r\n            }\r\n\r\n            addLegend() {\r\n                this.legend = this.svg.selectAll('.legend')\r\n                    .data(this.options.slice())\r\n                    .enter().append('g')\r\n                    .attr('class', 'legend')\r\n                    .attr('transform', (d, i)=> { return `translate(0,${i*20})`; });\r\n\r\n                this.legend.append('rect')\r\n                    .attr('x', this.width*1.1 - 18)\r\n                    .attr('width', 18)\r\n                    .attr('height', 18)\r\n                    .style('fill', this.color);\r\n\r\n                this.legend.append('text')\r\n                    .attr('x', this.width*1.1 - 24)\r\n                    .attr('y', 9)\r\n                    .attr('dy', '.35em')\r\n                    .style('text-anchor', 'end')\r\n                    .text(d=> { return d; });\r\n            }\r\n\r\n            addTooltips() {\r\n                this.tips = d3.select(this.element).append('div')\r\n                    .attr('class', 'toolTip');\r\n            }\r\n        }\r\n\r\n        function onRender() {\r\n            if(!ctrl.data) return;\r\n            let sample = [\r\n                {label:\"Machine001\", \"Off\":20, \"Down\":10, \"Run\": 50, \"Idle\":20},\r\n                {label:\"Machine002\", \"Off\":15, \"Down\":30, \"Run\":40, \"Idle\":15}\r\n            ];\r\n\r\n            var Chart = new groupedBarChart({\r\n                data: ctrl.data,\r\n                margin: {top: 10, left: 80, bottom: 10, right: 10},\r\n                element: '#chart',\r\n                width: ctrl.panel.width,\r\n                height: ctrl.panel.height,\r\n                legend: ctrl.panel.legend.show,\r\n                color: ctrl.panel.colorSch\r\n            });\r\n\r\n            ctrl.panel.colorSet = [];\r\n            Chart.options.forEach(d=> {\r\n                ctrl.panel.colorSet.push({text: d, color: Chart.color(d)});\r\n            });\r\n        }\r\n\r\n        this.events.on('render', function() {\r\n            onRender();\r\n        });\r\n    }\r\n}\r\n\r\nGroupedBarChartCtrl.templateUrl = 'partials/module.html';"]}