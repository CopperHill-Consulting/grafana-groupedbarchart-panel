{"version":3,"sources":["../src/ctrl.js"],"names":["panelDefaults","legend","show","position","chartType","labelOrientation","orientation","avgLineShow","labelSpace","links","datasource","maxDataPoints","interval","targets","cacheTimeout","nullPointMode","aliasColors","format","valueName","strokeWidth","fontSize","fontColor","marginTop","marginLeft","marginBottom","marginRight","paddingWidth","paddingHeight","colorSet","colorSch","GroupedBarChartCtrl","$scope","$injector","$rootScope","hiddenSeries","data","_","defaults","panel","events","on","onInitEditMode","bind","onDataReceived","onDataError","addEditorTab","subItem","value","render","forEach","d","push","color","dataList","length","o","groupBy","rows","e","forOwn","i","t","sta","sum","tid","map","s","reduce","x","y","res","label","sort","a","b","decimalInfo","getDecimalsForValue","formatFunc","kbn","valueFormats","decimals","scaledDecimals","scope","elem","attrs","ctrl","groupedBarChart","opts","margin","width","height","showLegend","legendType","axesConfig","element","find","options","d3","keys","filter","key","avgList","stackVal","valores","name","scale","ordinal","range","category20","draw","select","html","svg","append","attr","style","top","createScales","addAxes","addTooltips","addBar","addLegend","y0","rangeRoundBands","y1","linear","x0","x1","axesScale","xAxis","axis","tickSize","orient","yAxis","domain","rangeBand","chartScale","domainCal","max","xAxisConfig","left","call","selectAll","yAxisConfig","bar","enter","barC","text","tips","elements","elementData","__data__","display","loc","defaultOptions","slice","reverse","onRender","Chart","parseInt","bottom","right","MetricsPanelCtrl","templateUrl"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAMA,aAAa,GAAG;AAClBC,EAAAA,MAAM,EAAE;AACJC,IAAAA,IAAI,EAAE,IADF;AAEJC,IAAAA,QAAQ,EAAE;AAFN,GADU;AAKlBC,EAAAA,SAAS,EAAE,mBALO;AAMlBC,EAAAA,gBAAgB,EAAE,YANA;AAOlBC,EAAAA,WAAW,EAAE,UAPK;AAQlBC,EAAAA,WAAW,EAAE,IARK;AASlBC,EAAAA,UAAU,EAAE,EATM;AAUlBC,EAAAA,KAAK,EAAE,EAVW;AAWlBC,EAAAA,UAAU,EAAE,IAXM;AAYlBC,EAAAA,aAAa,EAAE,CAZG;AAalBC,EAAAA,QAAQ,EAAE,IAbQ;AAclBC,EAAAA,OAAO,EAAE,CAAC,EAAD,CAdS;AAelBC,EAAAA,YAAY,EAAE,IAfI;AAgBlBC,EAAAA,aAAa,EAAE,WAhBG;AAiBlBC,EAAAA,WAAW,EAAE,EAjBK;AAkBlBC,EAAAA,MAAM,EAAE,OAlBU;AAmBlBC,EAAAA,SAAS,EAAE,SAnBO;AAoBlBC,EAAAA,WAAW,EAAE,CApBK;AAqBlBC,EAAAA,QAAQ,EAAE,KArBQ;AAsBlBC,EAAAA,SAAS,EAAE,MAtBO;AAuBlBC,EAAAA,SAAS,EAAE,CAvBO;AAwBlBC,EAAAA,UAAU,EAAE,EAxBM;AAyBlBC,EAAAA,YAAY,EAAE,CAzBI;AA0BlBC,EAAAA,WAAW,EAAE,CA1BK;AA2BlBC,EAAAA,YAAY,EAAE,EA3BI;AA4BlBC,EAAAA,aAAa,EAAE,EA5BG;AA6BlBC,EAAAA,QAAQ,EAAE,EA7BQ;AA8BlBC,EAAAA,QAAQ,EAAE;AA9BQ,CAAtB;;IAiCaC,mB;;;;;AAET,+BAAYC,MAAZ,EAAoBC,SAApB,EAA+BC,UAA/B,EAA2C;AAAA;;AAAA;;AACvC,6FAAMF,MAAN,EAAcC,SAAd;AACA,UAAKC,UAAL,GAAkBA,UAAlB;AACA,UAAKC,YAAL,GAAoB,EAApB;AACA,UAAKC,IAAL,GAAY,IAAZ;;AAEAC,oBAAEC,QAAF,CAAW,MAAKC,KAAhB,EAAuBtC,aAAvB;;AAEA,UAAKuC,MAAL,CAAYC,EAAZ,CAAe,gBAAf,EAAiC,MAAKC,cAAL,CAAoBC,IAApB,+BAAjC;;AACA,UAAKH,MAAL,CAAYC,EAAZ,CAAe,eAAf,EAAgC,MAAKG,cAAL,CAAoBD,IAApB,+BAAhC;;AACA,UAAKH,MAAL,CAAYC,EAAZ,CAAe,oBAAf,EAAqC,MAAKG,cAAL,CAAoBD,IAApB,+BAArC;;AACA,UAAKH,MAAL,CAAYC,EAAZ,CAAe,YAAf,EAA6B,MAAKI,WAAL,CAAiBF,IAAjB,+BAA7B;;AAXuC;AAY1C;;;;qCAEgB;AACb,WAAKG,YAAL,CAAkB,SAAlB,EAA6B,mEAA7B,EAAkG,CAAlG;AACA,WAAKA,YAAL,CAAkB,QAAlB,EAA4B,mEAA5B,EAAiG,CAAjG;AACH;;;kCAEaC,O,EAAS;AACnB,WAAKR,KAAL,CAAWrB,MAAX,GAAoB6B,OAAO,CAACC,KAA5B;AACA,WAAKC,MAAL;AACH;;;kCAEa;AACV,WAAKA,MAAL;AACH;;;qCAEgB;AAAA;;AACb,WAAKV,KAAL,CAAWT,QAAX,GAAsB,EAAtB;AACA,WAAKS,KAAL,CAAWV,QAAX,CAAoBqB,OAApB,CAA4B,UAAAC,CAAC;AAAA,eAAI,MAAI,CAACZ,KAAL,CAAWT,QAAX,CAAoBsB,IAApB,CAAyBD,CAAC,CAACE,KAA3B,CAAJ;AAAA,OAA7B;AACA,WAAKJ,MAAL;AACH;;;mCAEcK,Q,EAAU;AACrB,UAAIA,QAAQ,IAAIA,QAAQ,CAACC,MAAzB,EAAiC;AAC7B,YAAIC,CAAC,GAAGnB,gBAAEoB,OAAF,CAAUH,QAAQ,CAAC,CAAD,CAAR,CAAYI,IAAtB,EAA4B,UAAAC,CAAC;AAAA,iBAAIA,CAAC,CAAC,CAAD,CAAL;AAAA,SAA7B,CAAR;;AACAtB,wBAAEuB,MAAF,CAASJ,CAAT,EAAY,UAACG,CAAD,EAAIE,CAAJ,EAAU;AAClB,cAAIC,CAAC,GAAGzB,gBAAEoB,OAAF,CAAUE,CAAV,EAAa,UAAAI,GAAG;AAAA,mBAAIA,GAAG,CAAC,CAAD,CAAP;AAAA,WAAhB,CAAR;;AACAP,UAAAA,CAAC,CAACK,CAAD,CAAD,GAAOxB,gBAAEuB,MAAF,CAASE,CAAT,EAAY,UAACE,GAAD,EAAMC,GAAN,EAAc;AAACH,YAAAA,CAAC,CAACG,GAAD,CAAD,GAASD,GAAG,CAACE,GAAJ,CAAQ,UAAAC,CAAC;AAAA,qBAAIA,CAAC,CAAC,CAAD,CAAL;AAAA,aAAT,EAAmBC,MAAnB,CAA0B,UAACC,CAAD,EAAGC,CAAH;AAAA,qBAASD,CAAC,GAACC,CAAX;AAAA,aAA1B,CAAT;AAAiD,WAA5E,CAAP;AACH,SAHD;;AAKA,YAAIC,GAAG,GAAG,EAAV;;AACAlC,wBAAEuB,MAAF,CAASJ,CAAT,EAAY,UAACG,CAAD,EAAIE,CAAJ,EAAU;AAClBF,UAAAA,CAAC,CAACa,KAAF,GAAUX,CAAV;AACAU,UAAAA,GAAG,CAACnB,IAAJ,CAASO,CAAT;AACH,SAHD;;AAIA,aAAKvB,IAAL,GAAYmC,GAAG,CAACE,IAAJ,CAAS,UAACC,CAAD,EAAIC,CAAJ,EAAU;AAAC,iBAAQD,CAAC,CAACF,KAAF,GAAQG,CAAC,CAACH,KAAX,GAAkB,CAAC,CAAnB,GAAuBG,CAAC,CAACH,KAAF,GAAQE,CAAC,CAACF,KAAX,GAAkB,CAAlB,GAAoB,CAAjD;AAAoD,SAAxE,CAAZ;AACH,OAbD,MAaO;AACH,aAAKpC,IAAL,GAAY,CACR;AAACoC,UAAAA,KAAK,EAAC,YAAP;AAAqB,iBAAM,EAA3B;AAA+B,kBAAO,EAAtC;AAA0C,iBAAO,CAAjD;AAAoD,kBAAO;AAA3D,SADQ,EAER;AAACA,UAAAA,KAAK,EAAC,YAAP;AAAqB,iBAAM,EAA3B;AAA+B,kBAAO,CAAtC;AAAyC,iBAAM,EAA/C;AAAmD,kBAAO;AAA1D,SAFQ,EAGR;AAACA,UAAAA,KAAK,EAAC,YAAP;AAAqB,iBAAM,EAA3B;AAA+B,kBAAO,EAAtC;AAA0C,iBAAM,EAAhD;AAAoD,kBAAO;AAA3D,SAHQ,EAIR;AAACA,UAAAA,KAAK,EAAC,YAAP;AAAqB,iBAAM,EAA3B;AAA+B,kBAAO,EAAtC;AAA0C,iBAAM,EAAhD;AAAoD,kBAAO;AAA3D,SAJQ,CAAZ;AAMH;;AAED,WAAKvB,MAAL;AACH;;;gCAEWD,K,EAAO;AACf,UAAI4B,WAAW,GAAG,KAAKC,mBAAL,CAAyB7B,KAAzB,CAAlB;AACA,UAAI8B,UAAU,GAAGC,aAAIC,YAAJ,CAAiB,KAAKzC,KAAL,CAAWrB,MAA5B,CAAjB;;AACA,UAAI4D,UAAJ,EAAgB;AACZ,eAAOA,UAAU,CAAC9B,KAAD,EAAQ4B,WAAW,CAACK,QAApB,EAA8BL,WAAW,CAACM,cAA1C,CAAjB;AACH;;AACD,aAAOlC,KAAP;AACH;;;yBAEImC,K,EAAOC,I,EAAMC,K,EAAOC,I,EAAM;AAAA,UACrBC,eADqB;AAAA;AAAA;AAEvB,iCAAYC,IAAZ,EAAkB;AAAA;;AAAA;;AACd,eAAKpD,IAAL,GAAYoD,IAAI,CAACpD,IAAjB;AACA,eAAKqD,MAAL,GAAcD,IAAI,CAACC,MAAnB;AACA,eAAKC,KAAL,GAAaF,IAAI,CAACE,KAAlB;AACA,eAAKC,MAAL,GAAcH,IAAI,CAACG,MAAnB;AACA,eAAKC,UAAL,GAAkBJ,IAAI,CAACtF,MAAvB;AACA,eAAK2F,UAAL,GAAkBL,IAAI,CAACpF,QAAvB;AACA,eAAKC,SAAL,GAAiBmF,IAAI,CAACnF,SAAtB;AACA,eAAKE,WAAL,GAAmBiF,IAAI,CAACjF,WAAxB;AACA,eAAKE,UAAL,GAAkB+E,IAAI,CAAC/E,UAAvB;AACA,eAAKa,SAAL,GAAiBkE,IAAI,CAAClE,SAAtB;AACA,eAAKhB,gBAAL,GAAwBkF,IAAI,CAAClF,gBAA7B;AACA,eAAKE,WAAL,GAAmBgF,IAAI,CAAChF,WAAxB;AACA,eAAKsF,UAAL,GAAkB,EAAlB;AACA,eAAKC,OAAL,GAAeX,IAAI,CAACY,IAAL,CAAUR,IAAI,CAACO,OAAf,EAAwB,CAAxB,CAAf;AACA,eAAKE,OAAL,GAAeC,EAAE,CAACC,IAAH,CAAQ,KAAK/D,IAAL,CAAU,CAAV,CAAR,EAAsBgE,MAAtB,CAA6B,UAASC,GAAT,EAAc;AAAE,mBAAOA,GAAG,KAAK,OAAf;AAAyB,WAAtE,CAAf;AACA,eAAKC,OAAL,GAAe,EAAf;AACA,eAAKL,OAAL,CAAa/C,OAAb,CAAqB,UAAAC,CAAC,EAAI;AAAC,YAAA,MAAI,CAACmD,OAAL,CAAanD,CAAb,IAAkB,CAAlB;AAAoB,WAA/C;AACA,eAAK8C,OAAL,GAAe,KAAKA,OAAL,CAAaG,MAAb,CAAoB,UAAAjD,CAAC;AAAA,mBAAIA,CAAC,KAAG,SAAR;AAAA,WAArB,CAAf;AACA,eAAKf,IAAL,CAAUc,OAAV,CAAkB,UAAAC,CAAC,EAAI;AACnB,gBAAIoD,QAAQ,GAAG,CAAf;AACApD,YAAAA,CAAC,CAACqD,OAAF,GAAY,MAAI,CAACP,OAAL,CAAa/B,GAAb,CAAiB,UAACuC,IAAD,EAAO5C,CAAP,EAAUL,CAAV,EAAgB;AACzC,kBAAIK,CAAC,KAAK,CAAV,EAAa0C,QAAQ,GAAGA,QAAQ,GAAI,CAACpD,CAAC,CAACK,CAAC,CAACK,CAAC,GAAC,CAAH,CAAF,CAAzB;AACb,cAAA,MAAI,CAACyC,OAAL,CAAaG,IAAb,IAAqB,MAAI,CAACH,OAAL,CAAaG,IAAb,IAAqBtD,CAAC,CAACsD,IAAD,CAA3C;AACA,qBAAO;AAACA,gBAAAA,IAAI,EAAEA,IAAP;AAAazD,gBAAAA,KAAK,EAAE,CAACG,CAAC,CAACsD,IAAD,CAAtB;AAA8BF,gBAAAA,QAAQ,EAAEA;AAAxC,eAAP;AACH,aAJW,CAAZ;AAKH,WAPD;AAQA,eAAKN,OAAL,CAAa/C,OAAb,CAAqB,UAAAC,CAAC,EAAI;AACtB,YAAA,MAAI,CAACmD,OAAL,CAAanD,CAAb,KAAmB,MAAI,CAACf,IAAL,CAAUmB,MAA7B;AACH,WAFD;;AAGA,cAAIiC,IAAI,CAACnC,KAAL,CAAWE,MAAX,IAAqB,CAAzB,EAA4B;AACxB,iBAAKF,KAAL,GAAa6C,EAAE,CAACQ,KAAH,CAASC,OAAT,GACRC,KADQ,CACFV,EAAE,CAACQ,KAAH,CAASG,UAAT,GAAsBD,KAAtB,EADE,CAAb;AAEH,WAHD,MAGO;AACH,iBAAKvD,KAAL,GAAa6C,EAAE,CAACQ,KAAH,CAASC,OAAT,GACRC,KADQ,CACFpB,IAAI,CAACnC,KADH,CAAb;AAEH;;AAED,eAAKyD,IAAL;AACH;;AAzCsB;AAAA;AAAA,iCA2ChB;AACHZ,YAAAA,EAAE,CAACa,MAAH,CAAU,KAAKhB,OAAf,EAAwBiB,IAAxB,CAA6B,EAA7B;AACA,iBAAKC,GAAL,GAAWf,EAAE,CAACa,MAAH,CAAU,KAAKhB,OAAf,EAAwBmB,MAAxB,CAA+B,KAA/B,CAAX;AACA,iBAAKD,GAAL,CAASE,IAAT,CAAc,OAAd,EAAuB,KAAKzB,KAA5B,EACKyB,IADL,CACU,QADV,EACoB,KAAKxB,MADzB,EAEI;AAFJ,aAGKwB,IAHL,CAGU,qBAHV,EAGiC,eAHjC,EAIKC,KAJL,CAIW,SAJX,EAIsB,MAJtB,EAKKD,IALL,CAKU,WALV,yBAKuC,KAAK1B,MAAL,CAAY4B,GALnD;AAOA,iBAAKC,YAAL;AACA,iBAAKC,OAAL;AACA,iBAAKC,WAAL;AACA,iBAAKC,MAAL;AACAvB,YAAAA,EAAE,CAACa,MAAH,CAAU,KAAKhB,OAAf,EAAwBoB,IAAxB,CAA6B,OAA7B,mBAAgD,KAAKzB,KAAL,GAAW,GAA3D,yBAA6E,KAAKC,MAAL,GAAY,GAAzF;AACA,gBAAI,KAAKC,UAAT,EAAqB,KAAK8B,SAAL,CAAe,KAAK7B,UAApB;AACxB;AA3DsB;AAAA;AAAA,yCA6DR;AACX,oBAAO,KAAKtF,WAAZ;AACI,mBAAK,YAAL;AACI,qBAAKoH,EAAL,GAAUzB,EAAE,CAACQ,KAAH,CAASC,OAAT,GACLiB,eADK,CACW,CAAC,CAAC,KAAKjC,MAAP,EAAe,CAAf,CADX,EAC8B,EAD9B,EACkC,GADlC,CAAV;AAGA,qBAAKkC,EAAL,GAAU3B,EAAE,CAACQ,KAAH,CAASC,OAAT,EAAV;AAEA,qBAAKtC,CAAL,GAAS6B,EAAE,CAACQ,KAAH,CAASoB,MAAT,GACJlB,KADI,CACE,CAAC,CAAD,EAAI,CAAC,KAAKlB,KAAV,CADF,CAAT;AAEA,qBAAKI,UAAL,GAAkB,CAAC,KAAKzB,CAAN,EAAS,KAAKsD,EAAd,EAAkB,KAAKA,EAAvB,EAA2B,KAAKE,EAAhC,EAAoC,KAAKxD,CAAzC,CAAlB;AACA;;AACJ,mBAAK,UAAL;AACI,qBAAK0D,EAAL,GAAU7B,EAAE,CAACQ,KAAH,CAASC,OAAT,GACLiB,eADK,CACW,CAAC,CAAD,EAAI,CAAC,KAAKlC,KAAV,CADX,EAC6B,EAD7B,EACiC,GADjC,CAAV;AAGA,qBAAKsC,EAAL,GAAU9B,EAAE,CAACQ,KAAH,CAASC,OAAT,EAAV;AAEA,qBAAKrC,CAAL,GAAS4B,EAAE,CAACQ,KAAH,CAASoB,MAAT,GACJlB,KADI,CACE,CAAC,CAAD,EAAI,CAAC,KAAKjB,MAAV,CADF,CAAT;AAGA,qBAAKG,UAAL,GAAkB,CAAC,KAAKiC,EAAN,EAAU,KAAKzD,CAAf,EAAkB,KAAKyD,EAAvB,EAA2B,KAAKC,EAAhC,EAAoC,KAAK1D,CAAzC,CAAlB;AACA;AArBR;AAwBH;AAtFsB;AAAA;AAAA,oCAwFb;AACN,gBAAI2D,SAAS,GAAG,GAAhB;AACA,iBAAKC,KAAL,GAAahC,EAAE,CAACe,GAAH,CAAOkB,IAAP,GACRzB,KADQ,CACF,KAAKZ,UAAL,CAAgB,CAAhB,CADE,EAERsC,QAFQ,CAEC,CAAC,KAAKzC,MAFP,EAGR0C,MAHQ,CAGD,QAHC,CAAb;AAKA,iBAAKC,KAAL,GAAapC,EAAE,CAACe,GAAH,CAAOkB,IAAP,GACRzB,KADQ,CACF,KAAKZ,UAAL,CAAgB,CAAhB,CADE,EAERuC,MAFQ,CAED,MAFC,CAAb;AAIA,iBAAKvC,UAAL,CAAgB,CAAhB,EAAmByC,MAAnB,CAA0B,KAAKnG,IAAL,CAAU8B,GAAV,CAAc,UAAAf,CAAC,EAAI;AAAE,qBAAOA,CAAC,CAACqB,KAAT;AAAiB,aAAtC,CAA1B;AACA,iBAAKsB,UAAL,CAAgB,CAAhB,EAAmByC,MAAnB,CAA0B,KAAKtC,OAA/B,EAAwC2B,eAAxC,CAAwD,CAAC,CAAD,EAAI,KAAK9B,UAAL,CAAgB,CAAhB,EAAmB0C,SAAnB,EAAJ,CAAxD;AAEA,gBAAIC,UAAU,GAAI,KAAKpI,SAAL,KAAmB,WAApB,GAAmC,CAAnC,GAAuC,CAAxD;AACA,gBAAIqI,SAAS,GAAI,KAAKnI,WAAL,KAAqB,YAAtB,GACV,CAAC,CAAD,EAAI2F,EAAE,CAACyC,GAAH,CAAO,KAAKvG,IAAZ,EAAkB,UAASe,CAAT,EAAY;AAAE,qBAAO+C,EAAE,CAACyC,GAAH,CAAOxF,CAAC,CAACqD,OAAT,EAAkB,UAAArD,CAAC,EAAI;AAAE,uBAAO,CAACA,CAAC,CAACH,KAAF,GAAUyF,UAAU,GAACtF,CAAC,CAACoD,QAAxB,IAAkC0B,SAAzC;AAAqD,eAA9E,CAAP;AAAyF,aAAzH,CAAJ,CADU,GAEV,CAAC/B,EAAE,CAACyC,GAAH,CAAO,KAAKvG,IAAZ,EAAkB,UAASe,CAAT,EAAY;AAAE,qBAAO+C,EAAE,CAACyC,GAAH,CAAOxF,CAAC,CAACqD,OAAT,EAAkB,UAAArD,CAAC,EAAI;AAAE,uBAAO,CAACA,CAAC,CAACH,KAAF,GAAUyF,UAAU,GAACtF,CAAC,CAACoD,QAAxB,IAAkC0B,SAAzC;AAAqD,eAA9E,CAAP;AAAyF,aAAzH,CAAD,EAA6H,CAA7H,CAFN;AAGA,iBAAKnC,UAAL,CAAgB,CAAhB,EAAmByC,MAAnB,CAA0BG,SAA1B;AAEA,gBAAIE,WAAW,GAAG,KAAK3B,GAAL,CAASC,MAAT,CAAgB,GAAhB,EACbC,IADa,CACR,OADQ,EACC,QADD,EAEbA,IAFa,CAER,WAFQ,sBAEkB,KAAK1B,MAAL,CAAYoD,IAF9B,eAEuC,KAAKlD,MAAL,GAAc,KAAKF,MAAL,CAAY4B,GAFjE,QAGbyB,IAHa,CAGR,KAAKZ,KAHG,EAIba,SAJa,CAIH,MAJG,EAKb3B,KALa,CAKP,MALO,YAKI,KAAK9F,SALT,EAAlB;;AAOA,oBAAO,KAAKhB,gBAAZ;AACI,mBAAK,YAAL;AACI;;AACJ,mBAAK,YAAL;AACIsI,gBAAAA,WAAW,CAACxB,KAAZ,CAAkB,aAAlB,EAAiC,KAAjC,EACKA,KADL,CACW,WADX,EACwB,gBADxB;AAEA;;AACJ,mBAAK,UAAL;AACIwB,gBAAAA,WAAW,CAACxB,KAAZ,CAAkB,aAAlB,EAAiC,KAAjC,EACKA,KADL,CACW,WADX,EACwB,gBADxB;AAEA;AAVR;;AAaA,gBAAI4B,WAAW,GAAG,KAAK/B,GAAL,CAASC,MAAT,CAAgB,GAAhB,EACbC,IADa,CACR,OADQ,EACC,QADD,EAEbA,IAFa,CAER,WAFQ,sBAEkB,KAAK1B,MAAL,CAAYoD,IAF9B,eAEuC,KAAKpD,MAAL,CAAY4B,GAFnD,QAGbD,KAHa,CAGP,MAHO,YAGI,KAAK9F,SAHT,GAIbwH,IAJa,CAIR,KAAKR,KAJG,CAAlB;AAMAU,YAAAA,WAAW,CAACD,SAAZ,CAAsB,MAAtB,EACK3B,KADL,CACW,MADX,YACsB,KAAK9F,SAD3B;AAEA0H,YAAAA,WAAW,CAACD,SAAZ,CAAsB,MAAtB,EACK3B,KADL,CACW,QADX,YACwB,KAAK9F,SAD7B;AAGH;AA3IsB;AAAA;AAAA,mCA6Id;AAAA;;AACL,gBAAIoF,KAAK,GAAI,KAAKrG,SAAL,KAAmB,WAApB,GAAmC,CAAnC,GAAuC,KAAK4F,OAAL,CAAa1C,MAAhE;;AACA,oBAAO,KAAKhD,WAAZ;AACI,mBAAK,YAAL;AACI,qBAAKC,WAAL,IAAoB,KAAKyF,OAAL,CAAa/C,OAAb,CAAqB,UAAAC,CAAC,EAAI;AAC1C,kBAAA,MAAI,CAAC8D,GAAL,CAASC,MAAT,CAAgB,MAAhB,EACKC,IADL,CACU,IADV,EACgB,MAAI,CAAC9C,CAAL,CAAO,MAAI,CAACiC,OAAL,CAAanD,CAAb,CAAP,CADhB,EAEKgE,IAFL,CAEU,IAFV,EAEgB,MAAI,CAACxB,MAFrB,EAGKwB,IAHL,CAGU,IAHV,EAGgB,MAAI,CAAC9C,CAAL,CAAO,MAAI,CAACiC,OAAL,CAAanD,CAAb,CAAP,CAHhB,EAIKgE,IAJL,CAIU,IAJV,EAIgB,CAJhB,EAKKA,IALL,CAKU,OALV,YAKsBhE,CALtB,eAMKgE,IANL,CAMU,WANV,sBAMoC,MAAI,CAAC1B,MAAL,CAAYoD,IANhD,eAMyD,MAAI,CAACpD,MAAL,CAAY4B,GANrE,QAOKD,KAPL,CAOW,SAPX,EAOsB,MAPtB,EAQKA,KARL,CAQW,cARX,EAQ2B,CAR3B,EASKA,KATL,CASW,QATX,EASqB,MAAI,CAAC/D,KAAL,CAAWF,CAAX,CATrB,EAUKiE,KAVL,CAUW,gBAVX,EAU6B,GAV7B;AAWH,iBAZmB,CAApB;AAcA,qBAAK6B,GAAL,GAAW,KAAKhC,GAAL,CAAS8B,SAAT,CAAmB,MAAnB,EACN3G,IADM,CACD,KAAKA,IADJ,EAEN8G,KAFM,GAEEhC,MAFF,CAES,GAFT,EAGNC,IAHM,CAGD,OAHC,EAGQ,MAHR,EAINA,IAJM,CAID,WAJC,EAIY,UAAAhE,CAAC,EAAI;AACpB,6CAAoB,MAAI,CAACsC,MAAL,CAAYoD,IAAhC,eAAyC,MAAI,CAAClB,EAAL,CAAQxE,CAAC,CAACqB,KAAV,IAAmB,MAAI,CAACiB,MAAL,CAAY4B,GAAxE;AACH,iBANM,CAAX;AAQA,qBAAK8B,IAAL,GAAY,KAAKF,GAAL,CAASF,SAAT,CAAmB,MAAnB,EACP3G,IADO,CACF,UAAAe,CAAC,EAAI;AAAE,yBAAOA,CAAC,CAACqD,OAAT;AAAmB,iBADxB,EAEP0C,KAFO,EAAZ;AAKA,qBAAKC,IAAL,CAAUjC,MAAV,CAAiB,MAAjB,EACKC,IADL,CACU,QADV,EACoB,KAAKU,EAAL,CAAQW,SAAR,KAAoB9B,KADxC,EAEKS,IAFL,CAEU,GAFV,EAEe,UAAAhE,CAAC,EAAI;AACZ,yBAAQ,MAAI,CAAC9C,SAAL,KAAmB,WAApB,GAAmC,MAAI,CAACwH,EAAL,CAAQ1E,CAAC,CAACsD,IAAV,CAAnC,GAAqD,MAAI,CAACkB,EAAL,CAAQxE,CAAC,CAACqB,KAAV,CAA5D;AACH,iBAJL,EAKK2C,IALL,CAKU,GALV,EAKe,UAAAhE,CAAC,EAAI;AACZ,yBAAQ,MAAI,CAAC9C,SAAL,KAAmB,WAApB,GAAmC,CAAnC,GAAuC,MAAI,CAACgE,CAAL,CAAOlB,CAAC,CAACoD,QAAT,CAA9C;AACH,iBAPL,EAQKY,IARL,CAQU,OARV,EAQmB,UAAAhE,CAAC,EAAI;AAAE,yBAAOA,CAAC,CAACsD,IAAT;AAAe,iBARzC,EASKU,IATL,CASU,OATV,EASmB,UAAChE,CAAD,EAAO;AAAE,yBAAO,MAAI,CAACkB,CAAL,CAAOlB,CAAC,CAACH,KAAT,CAAP;AAAwB,iBATpD,EAUKoE,KAVL,CAUW,MAVX,EAUmB,UAAAjE,CAAC,EAAI;AAAE,yBAAO,MAAI,CAACE,KAAL,CAAWF,CAAC,CAACsD,IAAb,CAAP;AAA2B,iBAVrD;AAYA;;AACJ,mBAAK,UAAL;AACI,qBAAKjG,WAAL,IAAoB,KAAKyF,OAAL,CAAa/C,OAAb,CAAqB,UAAAC,CAAC,EAAI;AAC1C,kBAAA,MAAI,CAAC8D,GAAL,CAASC,MAAT,CAAgB,MAAhB,EACKC,IADL,CACU,IADV,EACgB,CADhB,EAEKA,IAFL,CAEU,IAFV,EAEgB,MAAI,CAAC7C,CAAL,CAAO,MAAI,CAACgC,OAAL,CAAanD,CAAb,CAAP,CAFhB,EAGKgE,IAHL,CAGU,IAHV,EAGgB,CAAC,MAAI,CAACzB,KAHtB,EAIKyB,IAJL,CAIU,IAJV,EAIgB,MAAI,CAAC7C,CAAL,CAAO,MAAI,CAACgC,OAAL,CAAanD,CAAb,CAAP,CAJhB,EAKKgE,IALL,CAKU,OALV,YAKsBhE,CALtB,eAMKgE,IANL,CAMU,WANV,sBAMoC,MAAI,CAAC1B,MAAL,CAAYoD,IANhD,eAMyD,MAAI,CAACpD,MAAL,CAAY4B,GANrE,QAOKD,KAPL,CAOW,SAPX,EAOsB,MAPtB,EAQKA,KARL,CAQW,cARX,EAQ2B,CAR3B,EASKA,KATL,CASW,QATX,EASqB,MAAI,CAAC/D,KAAL,CAAWF,CAAX,CATrB,EAUKiE,KAVL,CAUW,gBAVX,EAU6B,GAV7B;AAWH,iBAZmB,CAApB;AAcA,qBAAK6B,GAAL,GAAW,KAAKhC,GAAL,CAAS8B,SAAT,CAAmB,MAAnB,EACN3G,IADM,CACD,KAAKA,IADJ,EAEN8G,KAFM,GAEEhC,MAFF,CAES,GAFT,EAGNC,IAHM,CAGD,OAHC,EAGQ,MAHR,EAINA,IAJM,CAID,WAJC,EAIY,UAAChE,CAAD,EAAIU,CAAJ,EAAU;AACzB,6CAAoB,MAAI,CAACkE,EAAL,CAAQ5E,CAAC,CAACqB,KAAV,CAApB,eAAyC,CAAC,MAAI,CAACmB,MAAN,GAAe,MAAI,CAACF,MAAL,CAAY4B,GAApE;AACH,iBANM,CAAX;AAQA,qBAAK8B,IAAL,GAAY,KAAKF,GAAL,CAASF,SAAT,CAAmB,MAAnB,EACP3G,IADO,CACF,UAAAe,CAAC,EAAI;AAAE,yBAAOA,CAAC,CAACqD,OAAF,CAAUtC,GAAV,CAAc,UAAAP,CAAC,EAAI;AAAEA,oBAAAA,CAAC,CAACa,KAAF,GAAUrB,CAAC,CAACqB,KAAZ;AAAmB,2BAAOb,CAAP;AAAU,mBAAlD,CAAP;AAA6D,iBADlE,EAEPuF,KAFO,EAAZ;AAIA,qBAAKC,IAAL,CAAUjC,MAAV,CAAiB,MAAjB,EACKC,IADL,CACU,IADV,EACgB,UAAChE,CAAD,EAAIU,CAAJ,EAAU;AAAE,mCAAUV,CAAC,CAACqB,KAAZ,cAAqBX,CAArB;AAA0B,iBADtD,EAEKsD,IAFL,CAEU,QAFV,EAEoB,UAAAhE,CAAC,EAAI;AAAE,yBAAO,CAAC,MAAI,CAACwC,MAAN,GAAe,MAAI,CAACrB,CAAL,CAAOnB,CAAC,CAACH,KAAT,CAAtB;AAAuC,iBAFlE,EAGKmE,IAHL,CAGU,GAHV,EAGe,UAAAhE,CAAC,EAAI;AACZ,yBAAQ,MAAI,CAAC9C,SAAL,KAAmB,WAApB,GAAmC,MAAI,CAACiE,CAAL,CAAOnB,CAAC,CAACH,KAAT,IAAkB,MAAI,CAAC2C,MAA1D,GAAqE,MAAI,CAACrB,CAAL,CAAOnB,CAAC,CAACH,KAAT,IAAkB,IAAG,CAAC,MAAI,CAAC2C,MAA3B,GAAqC,MAAI,CAACrB,CAAL,CAAOnB,CAAC,CAACoD,QAAT,CAAjH;AACH,iBALL,EAMKY,IANL,CAMU,GANV,EAMe,UAAChE,CAAD,EAAIU,CAAJ,EAAU;AACjB,yBAAQ,MAAI,CAACxD,SAAL,KAAmB,WAApB,GAAmC,MAAI,CAAC2H,EAAL,CAAQ7E,CAAC,CAACsD,IAAV,IAAkB,MAAI,CAAChB,MAAL,CAAYoD,IAAjE,GAAwE,MAAI,CAACb,EAAL,CAAQ7E,CAAC,CAACsD,IAAV,IAAkB,MAAI,CAACuB,EAAL,CAAQQ,SAAR,KAAoB3E,CAAtC,GAA0C,MAAI,CAAC4B,MAAL,CAAYoD,IAArI;AACH,iBARL,EASK1B,IATL,CASU,OATV,EASmB,UAAAhE,CAAC,EAAI;AAAE,yBAAOA,CAAC,CAACsD,IAAT;AAAe,iBATzC,EAUKU,IAVL,CAUU,OAVV,EAUmB,KAAKa,EAAL,CAAQQ,SAAR,KAAoB9B,KAVvC,EAWKU,KAXL,CAWW,MAXX,EAWmB,UAAAjE,CAAC,EAAI;AAAE,yBAAO,MAAI,CAACE,KAAL,CAAWF,CAAC,CAACsD,IAAb,CAAP;AAA2B,iBAXrD;AAaA;AAlFR;;AAqFC,iBAAKpG,SAAL,KAAmB,WAApB,IAAoC,KAAK8I,IAAL,CAAUjC,MAAV,CAAiB,MAAjB,EAC/BC,IAD+B,CAC1B,GAD0B,EACrB,UAAAhE,CAAC,EAAI;AACZ,qBAAQ,MAAI,CAAC5C,WAAL,KAAqB,YAAtB,GACL,MAAI,CAAC8D,CAAL,CAAOlB,CAAC,CAACH,KAAT,IAAiB,CADZ,GAEL,MAAI,CAACgF,EAAL,CAAQ7E,CAAC,CAACsD,IAAV,IAAkB,MAAI,CAACuB,EAAL,CAAQQ,SAAR,KAAoB,CAAtC,GAA0C,MAAI,CAAC/C,MAAL,CAAYoD,IAFxD;AAGH,aAL+B,EAM/B1B,IAN+B,CAM1B,GAN0B,EAMrB,UAAAhE,CAAC,EAAI;AACZ,qBAAQ,MAAI,CAAC5C,WAAL,KAAqB,YAAtB,GACL,MAAI,CAACsH,EAAL,CAAQ1E,CAAC,CAACsD,IAAV,IAAkB,MAAI,CAACoB,EAAL,CAAQW,SAAR,KAAoB,CADjC,GAEL,MAAI,CAAClE,CAAL,CAAOnB,CAAC,CAACH,KAAT,IAAkB,MAAI,CAAC2C,MAAvB,GAA+B,CAFjC;AAGH,aAV+B,EAW/BwB,IAX+B,CAW1B,IAX0B,EAWpB,OAXoB,EAY/BC,KAZ+B,CAYzB,MAZyB,YAYd,KAAK9F,SAZS,GAa/B8H,IAb+B,CAa1B,UAAAjG,CAAC,EAAI;AAAE,qBAAOA,CAAC,CAACH,KAAF,GAAUG,CAAC,CAACH,KAAZ,GAAoB,EAA3B;AAAgC,aAbb,CAApC;AAeA,iBAAKiG,GAAL,CAASxG,EAAT,CAAY,WAAZ,EAAyB,UAAAU,CAAC,EAAI;AAC1B,cAAA,MAAI,CAACkG,IAAL,CAAUjC,KAAV,CAAgB,MAAhB,YAA2B,EAA3B;;AACA,cAAA,MAAI,CAACiC,IAAL,CAAUjC,KAAV,CAAgB,KAAhB,YAA0B,EAA1B;;AACA,cAAA,MAAI,CAACiC,IAAL,CAAUjC,KAAV,CAAgB,SAAhB,EAA2B,cAA3B;;AACA,kBAAIkC,QAAQ,GAAGpD,EAAE,CAAC6C,SAAH,CAAa,QAAb,EAAuB,CAAvB,CAAf;AACA,kBAAIQ,WAAW,GAAGD,QAAQ,CAACA,QAAQ,CAAC/F,MAAT,GAAgB,CAAjB,CAAR,CAA4BiG,QAA9C;;AACA,cAAA,MAAI,CAACH,IAAL,CAAUrC,IAAV,WAAkB7D,CAAC,CAACqB,KAApB,gBAA+B+E,WAAW,CAAC9C,IAA3C,iBAAsD8C,WAAW,CAACvG,KAAlE;;AACA,kBAAI,MAAI,CAACxC,WAAT,EAAsB0F,EAAE,CAAC6C,SAAH,YAAiBQ,WAAW,CAAC9C,IAA7B,GAAqC,CAArC,EAAwC,CAAxC,EAA2CW,KAA3C,CAAiDqC,OAAjD,GAA2D,EAA3D;AACzB,aARD;AAUA,iBAAKR,GAAL,CAASxG,EAAT,CAAY,UAAZ,EAAwB,UAAAU,CAAC,EAAI;AACzB,cAAA,MAAI,CAACkG,IAAL,CAAUjC,KAAV,CAAgB,SAAhB,EAA2B,MAA3B;;AACAlB,cAAAA,EAAE,CAAC6C,SAAH,CAAa,UAAb,EAAyB,CAAzB,EAA4B7F,OAA5B,CAAoC,UAAAC,CAAC,EAAI;AACtCA,gBAAAA,CAAC,CAACiE,KAAF,CAAQqC,OAAR,GAAkB,MAAlB;AACF,eAFD;AAGH,aALD;AAMH;AAnQsB;AAAA;AAAA,oCAqQbC,GArQa,EAqQR;AAAA;;AACX,gBAAIjJ,UAAU,GAAG,KAAKA,UAAtB;;AACA,oBAAOiJ,GAAP;AACI,mBAAK,UAAL;AACI,oBAAIC,cAAc,GAAI,KAAKtJ,SAAL,IAAkB,WAAlB,IAAiC,KAAKE,WAAL,IAAoB,YAAtD,GAAsE,KAAK0F,OAAL,CAAa2D,KAAb,EAAtE,GAA4F,KAAK3D,OAAL,CAAa2D,KAAb,GAAqBC,OAArB,EAAjH;AACA,qBAAK3J,MAAL,GAAc,KAAK+G,GAAL,CAAS8B,SAAT,CAAmB,SAAnB,EACT3G,IADS,CACJuH,cADI,EAETT,KAFS,GAEDhC,MAFC,CAEM,GAFN,EAGTC,IAHS,CAGJ,OAHI,EAGK,QAHL,EAITA,IAJS,CAIJ,WAJI,EAIS,UAAChE,CAAD,EAAIU,CAAJ,EAAU;AAAE,gDAAuBA,CAAC,GAAC,EAAF,GAAO,MAAI,CAAC4B,MAAL,CAAY4B,GAA1C;AAAmD,iBAJxE,CAAd;AAMA,qBAAKnH,MAAL,CAAYgH,MAAZ,CAAmB,MAAnB,EACKC,IADL,CACU,GADV,EACe,KAAKzB,KAAL,GAAW,GAAX,GAAiB,EADhC,EAEKyB,IAFL,CAEU,OAFV,EAEmB,EAFnB,EAGKA,IAHL,CAGU,QAHV,EAGoB,EAHpB,EAIKC,KAJL,CAIW,MAJX,EAImB,KAAK/D,KAJxB;AAMA,qBAAKnD,MAAL,CAAYgH,MAAZ,CAAmB,MAAnB,EACKC,IADL,CACU,GADV,EACe,KAAKzB,KAAL,GAAW,GAAX,GAAiB,EADhC,EAEKyB,IAFL,CAEU,GAFV,EAEe,CAFf,EAGKA,IAHL,CAGU,IAHV,EAGgB,OAHhB,EAIKC,KAJL,CAIW,aAJX,EAI0B,KAJ1B,EAKKA,KALL,CAKW,MALX,YAKsB,KAAK9F,SAL3B,GAMK8H,IANL,CAMU,UAAAjG,CAAC,EAAI;AAAE,yBAAOA,CAAP;AAAW,iBAN5B;AAOA;;AACJ,mBAAK,aAAL;AACI,qBAAKjD,MAAL,GAAc,KAAK+G,GAAL,CAAS8B,SAAT,CAAmB,SAAnB,EACT3G,IADS,CACJ,KAAK6D,OAAL,CAAa2D,KAAb,EADI,EAETV,KAFS,GAEDhC,MAFC,CAEM,GAFN,EAGTC,IAHS,CAGJ,OAHI,EAGK,QAHL,EAITA,IAJS,CAIJ,WAJI,EAIS,UAAChE,CAAD,EAAIU,CAAJ,EAAU;AAAE,6CAAoB,CAACA,CAAD,GAAGpD,UAAH,GAAgB,MAAI,CAACiF,KAAzC,cAAkD,CAAC,MAAI,CAACC,MAAN,GAAe,EAAf,GAAoB,MAAI,CAACF,MAAL,CAAY4B,GAAlF;AAA2F,iBAJhH,CAAd;AAMA,qBAAKnH,MAAL,CAAYgH,MAAZ,CAAmB,MAAnB,EACKC,IADL,CACU,GADV,EACe,UAAChE,CAAD,EAAIU,CAAJ,EAAU;AAAE,yBAAQA,CAAC,GAACpD,UAAF,GAAe,MAAI,CAACgF,MAAL,CAAYoD,IAA3B,GAAkC,MAAI,CAACnD,KAAL,GAAW,CAA7C,GAAgD,CAAxD;AAA4D,iBADvF,EAEKyB,IAFL,CAEU,OAFV,EAEmB,EAFnB,EAGKA,IAHL,CAGU,QAHV,EAGoB,EAHpB,EAIKC,KAJL,CAIW,MAJX,EAImB,KAAK/D,KAJxB;AAMA,qBAAKnD,MAAL,CAAYgH,MAAZ,CAAmB,MAAnB,EACKC,IADL,CACU,GADV,EACe,UAAChE,CAAD,EAAIU,CAAJ,EAAU;AAAE,yBAAQA,CAAC,GAACpD,UAAF,GAAe,MAAI,CAACgF,MAAL,CAAYoD,IAA3B,GAAkC,MAAI,CAACnD,KAAL,GAAW,CAA9C,GAAkD,CAAzD;AAA6D,iBADxF,EAEKyB,IAFL,CAEU,IAFV,EAEgB,EAFhB,EAGKA,IAHL,CAGU,IAHV,EAGgB,OAHhB,EAIKC,KAJL,CAIW,aAJX,EAI0B,OAJ1B,EAKKA,KALL,CAKW,MALX,YAKsB,KAAK9F,SAL3B,GAMK8H,IANL,CAMU,UAAAjG,CAAC,EAAI;AAAE,yBAAOA,CAAP;AAAW,iBAN5B;AAOA;;AACJ;AACI;AA7CR;AA+CH;AAtTsB;AAAA;AAAA,wCAwTT;AACV,iBAAKkG,IAAL,GAAYnD,EAAE,CAACa,MAAH,CAAU,KAAKhB,OAAf,EAAwBmB,MAAxB,CAA+B,KAA/B,EACPC,IADO,CACF,OADE,EACO,SADP,CAAZ;AAEH;AA3TsB;;AAAA;AAAA;;AA8T3B,eAAS2C,QAAT,GAAoB;AAChB,YAAG,CAACxE,IAAI,CAAClD,IAAT,EAAe;AACf,YAAI2H,KAAK,GAAG,IAAIxE,eAAJ,CAAoB;AAC5BnD,UAAAA,IAAI,EAAEkD,IAAI,CAAClD,IADiB;AAE5BqD,UAAAA,MAAM,EAAE;AAAC4B,YAAAA,GAAG,EAAE2C,QAAQ,CAAC1E,IAAI,CAAC/C,KAAL,CAAWhB,SAAZ,EAAuB,EAAvB,CAAd;AAA0CsH,YAAAA,IAAI,EAAEmB,QAAQ,CAAC1E,IAAI,CAAC/C,KAAL,CAAWf,UAAZ,EAAwB,EAAxB,CAAxD;AAAqFyI,YAAAA,MAAM,EAAED,QAAQ,CAAC1E,IAAI,CAAC/C,KAAL,CAAWd,YAAZ,EAA0B,EAA1B,CAArG;AAAoIyI,YAAAA,KAAK,EAAEF,QAAQ,CAAC1E,IAAI,CAAC/C,KAAL,CAAWb,WAAZ,EAAyB,EAAzB;AAAnJ,WAFoB;AAG5BqE,UAAAA,OAAO,EAAE,QAHmB;AAI5BL,UAAAA,KAAK,EAAEN,IAAI,CAACM,KAAL,KAAasE,QAAQ,CAAC1E,IAAI,CAAC/C,KAAL,CAAWZ,YAAZ,EAA0B,EAA1B,CAJA;AAK5BgE,UAAAA,MAAM,EAAEL,IAAI,CAACK,MAAL,GAAYqE,QAAQ,CAAC1E,IAAI,CAAC/C,KAAL,CAAWX,aAAZ,EAA2B,EAA3B,CALA;AAM5B1B,UAAAA,MAAM,EAAEoF,IAAI,CAAC/C,KAAL,CAAWrC,MAAX,CAAkBC,IANE;AAO5BmB,UAAAA,SAAS,EAAEgE,IAAI,CAAC/C,KAAL,CAAWjB,SAPM;AAQ5BlB,UAAAA,QAAQ,EAAEkF,IAAI,CAAC/C,KAAL,CAAWrC,MAAX,CAAkBE,QARA;AAS5BC,UAAAA,SAAS,EAAEiF,IAAI,CAAC/C,KAAL,CAAWlC,SATM;AAU5BE,UAAAA,WAAW,EAAE+E,IAAI,CAAC/C,KAAL,CAAWhC,WAVI;AAW5BD,UAAAA,gBAAgB,EAAEgF,IAAI,CAAC/C,KAAL,CAAWjC,gBAXD;AAY5BG,UAAAA,UAAU,EAAE6E,IAAI,CAAC/C,KAAL,CAAW9B,UAZK;AAa5BD,UAAAA,WAAW,EAAE8E,IAAI,CAAC/C,KAAL,CAAW/B,WAbI;AAc5B6C,UAAAA,KAAK,EAAEiC,IAAI,CAAC/C,KAAL,CAAWT;AAdU,SAApB,CAAZ;AAiBAwD,QAAAA,IAAI,CAAC/C,KAAL,CAAWV,QAAX,GAAsB,EAAtB;AACAkI,QAAAA,KAAK,CAAC9D,OAAN,CAAc/C,OAAd,CAAsB,UAAAC,CAAC,EAAI;AACvBmC,UAAAA,IAAI,CAAC/C,KAAL,CAAWV,QAAX,CAAoBuB,IAApB,CAAyB;AAACgG,YAAAA,IAAI,EAAEjG,CAAP;AAAUE,YAAAA,KAAK,EAAE0G,KAAK,CAAC1G,KAAN,CAAYF,CAAZ;AAAjB,WAAzB;AACH,SAFD;AAGH;;AAED,WAAKX,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,YAAW;AAChCqH,QAAAA,QAAQ;AACX,OAFD;AAGH;;;;EAjaoCK,qB;;;AAoazCpI,mBAAmB,CAACqI,WAApB,GAAkC,sBAAlC","sourcesContent":["import {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport _ from 'lodash';\nimport kbn from 'app/core/utils/kbn';\nimport TimeSeries from 'app/core/time_series';\nimport * as d3 from './external/d3.v3.min';\nimport './css/groupedBarChart.css!';\n\nconst panelDefaults = {\n    legend: {\n        show: true,\n        position: 'On graph',\n    },\n    chartType: 'stacked bar chart',\n    labelOrientation: 'horizontal',\n    orientation: 'vertical',\n    avgLineShow: true,\n    labelSpace: 40,\n    links: [],\n    datasource: null,\n    maxDataPoints: 3,\n    interval: null,\n    targets: [{}],\n    cacheTimeout: null,\n    nullPointMode: 'connected',\n    aliasColors: {},\n    format: 'short',\n    valueName: 'current',\n    strokeWidth: 1,\n    fontSize: '80%',\n    fontColor: '#fff',\n    marginTop: 0,\n    marginLeft: 40,\n    marginBottom: 0,\n    marginRight: 0,\n    paddingWidth: 40,\n    paddingHeight: 80,\n    colorSet: [],\n    colorSch: []\n};\n\nexport class GroupedBarChartCtrl extends MetricsPanelCtrl {\n\n    constructor($scope, $injector, $rootScope) {\n        super($scope, $injector);\n        this.$rootScope = $rootScope;\n        this.hiddenSeries = {};\n        this.data = null;\n\n        _.defaults(this.panel, panelDefaults);\n\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n        this.events.on('data-received', this.onDataReceived.bind(this));\n        this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n        this.events.on('data-error', this.onDataError.bind(this));\n    }\n\n    onInitEditMode() {\n        this.addEditorTab('Options', 'public/plugins/grafana-groupedbarchart-panel/partials/editor.html', 2);\n        this.addEditorTab('Colors', 'public/plugins/grafana-groupedbarchart-panel/partials/colors.html', 3);\n    }\n\n    setUnitFormat(subItem) {\n        this.panel.format = subItem.value;\n        this.render();\n    }\n\n    onDataError() {\n        this.render();\n    }\n\n    updateColorSet() {\n        this.panel.colorSch = [];\n        this.panel.colorSet.forEach(d => this.panel.colorSch.push(d.color));\n        this.render();\n    }\n\n    onDataReceived(dataList) {\n        if (dataList && dataList.length) {\n            let o = _.groupBy(dataList[0].rows, e => e[0]);\n            _.forOwn(o, (e, i) => {\n                let t = _.groupBy(e, sta => sta[1]);\n                o[i] = _.forOwn(t, (sum, tid) => {t[tid] = sum.map(s => s[2]).reduce((x,y) => x+y)})\n            });\n\n            let res = [];\n            _.forOwn(o, (e, i) => {\n                e.label = i;\n                res.push(e);\n            });\n            this.data = res.sort((a, b) => {return (a.label>b.label)?-1:((b.label>a.label)?1:0)});\n        } else {\n            this.data = [\n                {label:\"Machine001\", \"Off\":15, \"Down\":50, \"Run\": 0, \"Idle\":40},\n                {label:\"Machine002\", \"Off\":15, \"Down\":5, \"Run\":40, \"Idle\":15},\n                {label:\"Machine003\", \"Off\":15, \"Down\":30, \"Run\":40, \"Idle\":15},\n                {label:\"Machine004\", \"Off\":15, \"Down\":30, \"Run\":80, \"Idle\":15}\n            ];\n        }\n\n        this.render();\n    }\n\n    formatValue(value) {\n        let decimalInfo = this.getDecimalsForValue(value);\n        let formatFunc = kbn.valueFormats[this.panel.format];\n        if (formatFunc) {\n            return formatFunc(value, decimalInfo.decimals, decimalInfo.scaledDecimals);\n        }\n        return value;\n    }\n\n    link(scope, elem, attrs, ctrl) {\n        class groupedBarChart {\n            constructor(opts) {\n                this.data = opts.data;\n                this.margin = opts.margin;\n                this.width = opts.width;\n                this.height = opts.height;\n                this.showLegend = opts.legend;\n                this.legendType = opts.position;\n                this.chartType = opts.chartType;\n                this.orientation = opts.orientation;\n                this.labelSpace = opts.labelSpace;\n                this.fontColor = opts.fontColor;\n                this.labelOrientation = opts.labelOrientation;\n                this.avgLineShow = opts.avgLineShow;\n                this.axesConfig = [];\n                this.element = elem.find(opts.element)[0];\n                this.options = d3.keys(this.data[0]).filter(function(key) { return key !== 'label'; });\n                this.avgList = {};\n                this.options.forEach(d => {this.avgList[d] = 0});\n                this.options = this.options.filter(d => d!=='valores');\n                this.data.forEach(d => {\n                    let stackVal = 0;\n                    d.valores = this.options.map((name, i, o) => {\n                        if (i !== 0) stackVal = stackVal + (+d[o[i-1]]);\n                        this.avgList[name] = this.avgList[name] + d[name];\n                        return {name: name, value: +d[name], stackVal: stackVal};\n                    });\n                });\n                this.options.forEach(d => {\n                    this.avgList[d] /= this.data.length;\n                });\n                if (opts.color.length == 0) {\n                    this.color = d3.scale.ordinal()\n                        .range(d3.scale.category20().range());\n                } else {\n                    this.color = d3.scale.ordinal()\n                        .range(opts.color);\n                }\n\n                this.draw();\n            }\n\n            draw() {\n                d3.select(this.element).html(\"\");\n                this.svg = d3.select(this.element).append('svg');\n                this.svg.attr('width', this.width)\n                    .attr('height', this.height)\n                    // .attr('viewBox', `0, 0, ${this.width}, ${this.height}`)\n                    .attr('preserveAspectRatio', 'xMinYMin meet')\n                    .style('padding', '10px')\n                    .attr('transform', `translate(0, ${this.margin.top})`);\n\n                this.createScales();\n                this.addAxes();\n                this.addTooltips();\n                this.addBar();\n                d3.select(this.element).attr('style', `width: ${this.width*1.5}px; height: ${this.height*1.5}px`);\n                if (this.showLegend) this.addLegend(this.legendType);\n            }\n\n            createScales() {\n                switch(this.orientation) {\n                    case 'horizontal':\n                        this.y0 = d3.scale.ordinal()\n                            .rangeRoundBands([+this.height, 0], .2, 0.5);\n\n                        this.y1 = d3.scale.ordinal();\n\n                        this.x = d3.scale.linear()\n                            .range([0, +this.width]);\n                        this.axesConfig = [this.x, this.y0, this.y0, this.y1, this.x];\n                        break;\n                    case 'vertical':\n                        this.x0 = d3.scale.ordinal()\n                            .rangeRoundBands([0, +this.width], .2, 0.5);\n\n                        this.x1 = d3.scale.ordinal();\n\n                        this.y = d3.scale.linear()\n                            .range([0, +this.height]);\n\n                        this.axesConfig = [this.x0, this.y, this.x0, this.x1, this.y];\n                        break;\n                }\n\n            }\n\n            addAxes() {\n                let axesScale = 1.1;\n                this.xAxis = d3.svg.axis()\n                    .scale(this.axesConfig[0])\n                    .tickSize(-this.height)\n                    .orient('bottom');\n\n                this.yAxis = d3.svg.axis()\n                    .scale(this.axesConfig[1])\n                    .orient('left');\n\n                this.axesConfig[2].domain(this.data.map(d => { return d.label; }));\n                this.axesConfig[3].domain(this.options).rangeRoundBands([0, this.axesConfig[2].rangeBand()]);\n\n                let chartScale = (this.chartType === 'bar chart') ? 0 : 1;\n                let domainCal = (this.orientation === 'horizontal')\n                    ? [0, d3.max(this.data, function(d) { return d3.max(d.valores, d => { return (d.value + chartScale*d.stackVal)*axesScale; }); })]\n                    : [d3.max(this.data, function(d) { return d3.max(d.valores, d => { return (d.value + chartScale*d.stackVal)*axesScale; }); }), 0];\n                this.axesConfig[4].domain(domainCal);\n\n                let xAxisConfig = this.svg.append('g')\n                    .attr('class', 'x axis')\n                    .attr('transform', `translate(${this.margin.left}, ${this.height + this.margin.top})`)\n                    .call(this.xAxis)\n                    .selectAll('text')\n                    .style('fill', `${this.fontColor}`)\n\n                switch(this.labelOrientation) {\n                    case 'horizontal':\n                        break;\n                    case '45 degrees':\n                        xAxisConfig.style('text-anchor', 'end')\n                            .style('transform', 'rotate(-45deg)');\n                        break;\n                    case 'vertical':\n                        xAxisConfig.style('text-anchor', 'end')\n                            .style('transform', 'rotate(-90deg)');\n                        break;\n                }\n\n                let yAxisConfig = this.svg.append('g')\n                    .attr('class', 'y axis')\n                    .attr('transform', `translate(${this.margin.left}, ${this.margin.top})`)\n                    .style('fill', `${this.fontColor}`)\n                    .call(this.yAxis)\n\n                yAxisConfig.selectAll('text')\n                    .style('fill', `${this.fontColor}`);\n                yAxisConfig.selectAll('path')\n                    .style('stroke', `${this.fontColor}`);\n\n            }\n\n            addBar() {\n                let scale = (this.chartType === 'bar chart') ? 1 : this.options.length;\n                switch(this.orientation) {\n                    case 'horizontal':\n                        this.avgLineShow && this.options.forEach(d => {\n                            this.svg.append('line')\n                                .attr('x1', this.x(this.avgList[d]))\n                                .attr('y1', this.height)\n                                .attr('x2', this.x(this.avgList[d]))\n                                .attr('y2', 0)\n                                .attr('class', `${d} avgLine`)\n                                .attr('transform', `translate(${this.margin.left}, ${this.margin.top})`)\n                                .style('display', 'none')\n                                .style('stroke-width', 2)\n                                .style('stroke', this.color(d))\n                                .style('stroke-opacity', 0.7);\n                        });\n\n                        this.bar = this.svg.selectAll('.bar')\n                            .data(this.data)\n                            .enter().append('g')\n                            .attr('class', 'rect')\n                            .attr('transform', d => {\n                                return `translate(${this.margin.left}, ${this.y0(d.label) + this.margin.top})`;\n                            });\n\n                        this.barC = this.bar.selectAll('rect')\n                            .data(d => { return d.valores; })\n                            .enter();\n\n\n                        this.barC.append('rect')\n                            .attr('height', this.y1.rangeBand()*scale)\n                            .attr('y', d => {\n                                return (this.chartType === 'bar chart') ? this.y1(d.name) : this.y0(d.label);\n                            })\n                            .attr('x', d => {\n                                return (this.chartType === 'bar chart') ? 0 : this.x(d.stackVal);\n                            })\n                            .attr('value', d => { return d.name;})\n                            .attr('width', (d) => { return this.x(d.value);})\n                            .style('fill', d => { return this.color(d.name);});\n\n                        break;\n                    case 'vertical':\n                        this.avgLineShow && this.options.forEach(d => {\n                            this.svg.append('line')\n                                .attr('x1', 0)\n                                .attr('y1', this.y(this.avgList[d]))\n                                .attr('x2', +this.width)\n                                .attr('y2', this.y(this.avgList[d]))\n                                .attr('class', `${d} avgLine`)\n                                .attr('transform', `translate(${this.margin.left}, ${this.margin.top})`)\n                                .style('display', 'none')\n                                .style('stroke-width', 2)\n                                .style('stroke', this.color(d))\n                                .style('stroke-opacity', 0.7)\n                        });\n\n                        this.bar = this.svg.selectAll('.bar')\n                            .data(this.data)\n                            .enter().append('g')\n                            .attr('class', 'rect')\n                            .attr('transform', (d, i) => {\n                                return `translate(${this.x0(d.label)}, ${+this.height + this.margin.top})`;\n                            });\n\n                        this.barC = this.bar.selectAll('rect')\n                            .data(d => { return d.valores.map(e => { e.label = d.label; return e;}); })\n                            .enter();\n\n                        this.barC.append('rect')\n                            .attr('id', (d, i) => { return `${d.label}_${i}`;})\n                            .attr('height', d => { return +this.height - this.y(d.value);})\n                            .attr('y', d => {\n                                return (this.chartType === 'bar chart') ? this.y(d.value) - this.height :  (this.y(d.value) - 2*(+this.height) + this.y(d.stackVal));\n                            })\n                            .attr('x', (d, i) => {\n                                return (this.chartType === 'bar chart') ? this.x1(d.name) + this.margin.left : this.x1(d.name) - this.x1.rangeBand()*i + this.margin.left;\n                            })\n                            .attr('value', d => { return d.name;})\n                            .attr('width', this.x1.rangeBand()*scale)\n                            .style('fill', d => { return this.color(d.name);});\n\n                        break;\n                }\n\n                (this.chartType === 'bar chart') && this.barC.append('text')\n                    .attr('x', d => {\n                        return (this.orientation === 'horizontal')\n                        ? this.x(d.value) +5\n                        : this.x1(d.name) + this.x1.rangeBand()/4 + this.margin.left;\n                    })\n                    .attr('y', d => {\n                        return (this.orientation === 'horizontal')\n                        ? this.y1(d.name) +(this.y1.rangeBand()/2)\n                        : this.y(d.value) - this.height -8;\n                    })\n                    .attr('dy', '.35em')\n                    .style('fill', `${this.fontColor}`)\n                    .text(d => { return d.value ? d.value : ''; });\n\n                this.bar.on('mouseover', d => {\n                    this.tips.style('left', `${10}px`);\n                    this.tips.style('top', `${15}px`);\n                    this.tips.style('display', \"inline-block\");\n                    let elements = d3.selectAll(':hover')[0];\n                    let elementData = elements[elements.length-1].__data__;\n                    this.tips.html(`${d.label} , ${elementData.name} ,  ${elementData.value}`);\n                    if (this.avgLineShow) d3.selectAll(`.${elementData.name}`)[0][0].style.display = '';\n                });\n\n                this.bar.on('mouseout', d => {\n                    this.tips.style('display', \"none\");\n                    d3.selectAll('.avgLine')[0].forEach(d => {\n                       d.style.display = 'none';\n                    });\n                });\n            }\n\n            addLegend(loc) {\n                let labelSpace = this.labelSpace;\n                switch(loc) {\n                    case 'On graph':\n                        let defaultOptions = (this.chartType == 'bar chart' || this.orientation == 'horizontal') ? this.options.slice(): this.options.slice().reverse();\n                        this.legend = this.svg.selectAll('.legend')\n                            .data(defaultOptions)\n                            .enter().append('g')\n                            .attr('class', 'legend')\n                            .attr('transform', (d, i) => { return `translate(50,${i*20 + this.margin.top})`; });\n\n                        this.legend.append('rect')\n                            .attr('x', this.width*1.1 - 18)\n                            .attr('width', 18)\n                            .attr('height', 18)\n                            .style('fill', this.color);\n\n                        this.legend.append('text')\n                            .attr('x', this.width*1.1 - 24)\n                            .attr('y', 9)\n                            .attr('dy', '.35em')\n                            .style('text-anchor', 'end')\n                            .style('fill', `${this.fontColor}`)\n                            .text(d => { return d; });\n                        break;\n                    case 'Under graph':\n                        this.legend = this.svg.selectAll('.legend')\n                            .data(this.options.slice())\n                            .enter().append('g')\n                            .attr('class', 'legend')\n                            .attr('transform', (d, i) => { return `translate(${+i*labelSpace - this.width},${+this.height + 24 + this.margin.top})`; });\n\n                        this.legend.append('rect')\n                            .attr('x', (d, i) => { return (i*labelSpace + this.margin.left + this.width*1 +0);})\n                            .attr('width', 18)\n                            .attr('height', 18)\n                            .style('fill', this.color);\n\n                        this.legend.append('text')\n                            .attr('x', (d, i) => { return (i*labelSpace + this.margin.left + this.width*1) +5; })\n                            .attr('dx', 18)\n                            .attr('dy', '1.1em')\n                            .style('text-anchor', 'start')\n                            .style('fill', `${this.fontColor}`)\n                            .text(d => { return d; });\n                        break;\n                    default:\n                        break;\n                }\n            }\n\n            addTooltips() {\n                this.tips = d3.select(this.element).append('div')\n                    .attr('class', 'toolTip');\n            }\n        }\n\n        function onRender() {\n            if(!ctrl.data) return;\n            var Chart = new groupedBarChart({\n                data: ctrl.data,\n                margin: {top: parseInt(ctrl.panel.marginTop, 10), left: parseInt(ctrl.panel.marginLeft, 10), bottom: parseInt(ctrl.panel.marginBottom, 10), right: parseInt(ctrl.panel.marginRight, 10) },\n                element: '#chart',\n                width: elem.width()-parseInt(ctrl.panel.paddingWidth, 10),\n                height: ctrl.height-parseInt(ctrl.panel.paddingHeight, 10),\n                legend: ctrl.panel.legend.show,\n                fontColor: ctrl.panel.fontColor,\n                position: ctrl.panel.legend.position,\n                chartType: ctrl.panel.chartType,\n                orientation: ctrl.panel.orientation,\n                labelOrientation: ctrl.panel.labelOrientation,\n                labelSpace: ctrl.panel.labelSpace,\n                avgLineShow: ctrl.panel.avgLineShow,\n                color: ctrl.panel.colorSch\n            });\n\n            ctrl.panel.colorSet = [];\n            Chart.options.forEach(d => {\n                ctrl.panel.colorSet.push({text: d, color: Chart.color(d)});\n            });\n        }\n\n        this.events.on('render', function() {\n            onRender();\n        });\n    }\n}\n\nGroupedBarChartCtrl.templateUrl = 'partials/module.html';\n"],"file":"ctrl.js"}